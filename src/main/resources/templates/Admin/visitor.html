<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymelef.org">

<head th:fragment="admin-header">

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title> Admin DashBoard</title>

	<!-- base:css -->
	<link rel="stylesheet" href="Admin/vendors/mdi/css/materialdesignicons.min.css">
	<link rel="stylesheet" href="Admin/vendors/feather/feather.css">
	<link rel="stylesheet" href="Admin/vendors/base/vendor.bundle.base.css">
	<!-- endinject -->

	<!-- plugin css for this page -->
	<link rel="stylesheet" href="Admin/vendors/flag-icon-css/css/flag-icon.min.css" />
	<link rel="stylesheet" href="Admin/vendors/font-awesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="Admin/vendors/jquery-bar-rating/fontawesome-stars-o.css">
	<link rel="stylesheet" href="Admin/vendors/jquery-bar-rating/fontawesome-stars.css">
	<!-- End plugin css for this page -->
	<!-- inject:css -->

	<link rel="stylesheet" href="Admin/css/style.css">
	<!-- endinject -->
	<link rel="shortcut icon" href="Admin/images/favicon.png" />
</head>

<body>

	<!-- Navbar start -->
	<div class="container-scroller">
		<nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
			<div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
			</div>
			<div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
				<button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
					<span class="icon-menu"></span>
				</button>
				<ul class="navbar-nav mr-lg-2">
					<li class="nav-item nav-search d-none d-lg-block">
						<div class="input-group">
							<div class="input-group-prepend">
								<span class="input-group-text" id="search">
									<i class="icon-search"></i>
								</span>
							</div>
							<input type="text" class="form-control" placeholder="Search Projects.." aria-label="search"
								aria-describedby="search">
						</div>
					</li>
				</ul>
				<ul class="navbar-nav navbar-nav-right">

					<li class="nav-item dropdown d-flex">
						<a class="nav-link count-indicator dropdown-toggle d-flex justify-content-center align-items-center"
							id="messageDropdown" href="#" data-toggle="dropdown">
							<i class="icon-air-play mx-0"></i>
						</a>
						<div class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list"
							aria-labelledby="messageDropdown">
							<p class="mb-0 font-weight-normal float-left dropdown-header">Messages</p>
							<a class="dropdown-item preview-item">
								<div class="preview-thumbnail">
									<img src="Admin/images/faces/face4.jpg" alt="image" class="profile-pic">
								</div>
								<div class="preview-item-content flex-grow">
									<h6 class="preview-subject ellipsis font-weight-normal">David Grey
									</h6>
									<p class="font-weight-light small-text text-muted mb-0">
										The meeting is cancelled
									</p>
								</div>
							</a>

						</div>
					</li>




					<li class="nav-item dropdown d-flex mr-4 ">
						<a class="nav-link count-indicator dropdown-toggle d-flex align-items-center justify-content-center"
							id="notificationDropdown" href="#" data-toggle="dropdown">
							<i class="icon-cog"></i>
						</a>
						<div class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list"
							aria-labelledby="notificationDropdown">
							<p class="mb-0 font-weight-normal float-left dropdown-header">Settings</p>
							<a class="dropdown-item preview-item">
								<i class="icon-head"></i> Profile
							</a>
							<a class="dropdown-item preview-item">
								<i class="icon-inbox"></i> Logout
							</a>
						</div>
					</li>
					<li class="nav-item dropdown mr-4 d-lg-flex d-none">
						<a class="nav-link count-indicatord-flex align-item s-center justify-content-center" href="#">
							<i class="icon-grid"></i>
						</a>
					</li>
				</ul>
				<button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button"
					data-toggle="offcanvas">
					<span class="icon-menu"></span>
				</button>
			</div>
		</nav>


		<!-- Navbar End -->


		<!-- partial -->

		<!--########################## Side Bar ##########################-->

		<div class="container-fluid page-body-wrapper">
			<!-- partial:partials/_sidebar.html -->


			<div class="sidebar" th:replace="Admin/index :: admin-sidebar"></div>

			<!-- <nav class="sidebar sidebar-offcanvas active">
        <div class="user-profile">
          <div class="user-image">
            <img src="Admin/images/faces/face28.png">
          </div>
          <div class="user-name">
            <h3> Admin </h3>
          </div>
        
        </div>
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="/employee">
              <i class="icon-command menu-icon"></i>
              <span class="menu-title">Employee</span>    Table change to Employee    
            </a>
          </li>
         
          
           <li class="nav-item">
            <a class="nav-link" href="/login">
              <i class="icon-help menu-icon"></i>
              <span class="menu-title">Logout</span>
            </a>
          </li>
           
        </ul>
      </nav>-->


			<!-- Side Bar End -->

			<!-- partial -->

			<body onload="getVisitorTable()">


				<div class="main-panel">
					<div class="content-wrapper">
						<div class="row">
							<!--<h1 class="text-white bg-dark text-center">EMPLOYEE DATA</h1> -->
							<li class="nav-item dropdown d-lg-flex d-none">
								<button type="button" class="btn btn-info font-weight-bold" data-toggle="modal"
									data-target="#addbtn">Add Visitor</button>
							</li>

							<!--<div class="form-groupp">
							<select id="visitor" name="type" class="form-control custom-select" required>
								<option selected disabled></option>
								<option>Developer</option>
								<option>Tester</option>
								<option>Digital Marketing</option>
							</select>
						</div>-->


							<div class="form-groupp">
								<select id="emplist" class="form-control custom-select" required>
									<option value="" disabled selected>--SELECT EMPLOYEE--</option>
								</select>
							</div>&nbsp;&nbsp;&nbsp;

							<li class="nav-item dropdown d-lg-flex d-none">
								<button type="button" id="assignMeet" onclick="assignMeeting();"
									class="btn btn-info font-weight-bold">Assign</button>
							</li>





							<!--<div class="form-group">  style="width:200px;"
							<label for="inputStatus">LEAVE TYPE</label>
							<select id="empleaveType" name="type" class="form-control custom-select" required>
							<option selected disabled>Select one</option>
							<option>On Hold</option>
							<option>Canceled</option>
							<option>Success</option>
							</select>
							</div>-->

							<br>
							<ul class="navbar-nav navbar-nav-right">
						</div>
						<br>
						<div class="table-responsive pt-3">
							<table class="table table-bordered table-dark">
								<thead>
									<tr>
										<th>$</th>
										<th>VISITOR NAME</th>
										<th>VISITOR EMAIL</th>
										<th>VISITOR MOBILE</th>
										<th>FOR REASON</th>
										<th>MEET TO WHOM</th>
										<th>STATUS</th>
										<th>FOR WHOM</th>
										<th>ACTION</th>
									</tr>
								</thead>
								<tbody id="Table">


								</tbody>
							</table>

						</div>

						<!--  Model ADD New  -->

						<div class="modal fade" id="addbtn" tabindex="-1" role="dialog"
							aria-labelledby="exampleModalLabel" aria-hidden="true">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h4 class="modal-title" id="exampleModalLabel">ADD VISITOR</h4>
										<button type="button" class="close" data-dismiss="modal" aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<!-- only change div -->

									<div class="modal-body">

										<form id="Visitorform">
											<div class="form-group">
												<label for="recipient-name" class="col-form-label">Visitor Name:</label>
												<input type="text" placeholder="Enter name" class="form-control"
													id="vname1" name="name" required>
											</div>
											<div class="form-group">
												<label for="recipient-name" class="col-form-label">Visitor
													Email:</label>
												<input type="email" placeholder="Enter email" class="form-control"
													id="vemail2" name="email" required>
												<input type="hidden" name="status" value="NEW">
												<!-- new field must be hideen  -->

											</div>

											<div class="form-group">
												<label for="message-text" class="col-form-label">Visitor Mobile:</label>
												<input type="tel" placeholder="Enter mobile" class="form-control"
													id="vmobile3" name="mobile" required></textarea>
											</div>

											<div class="form-group">
												<label for="message-text" class="col-form-label">For Reason:</label>
												<input type="text" placeholder="Enter the reason" class="form-control"
													id="vreason4" name="reason" required></textarea>
											</div>

											<div class="form-group">
												<label for="recipient-name" class="col-form-label">Meeting for:
												</label>
												<select name="meeting" id="vmeet5" class="form-control">
													<option value="Developer">Developer</option>
													<option value="Tester">Tester</option>
													<option value="Digital Marketing">Digital Marketing</option>
												</select>
											</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-secondary"
													data-dismiss="modal">CLOSE</button>

												<button type="submit" class="btn btn-primary">SAVE</button>

											</div>

										</form>
									</div>

								</div>
							</div>
						</div>

						<!-- model end -->

						<!-- Update modal Start -->

						<div class="modal fade" id="updatebtn" tabindex="-1" role="dialog"
							aria-labelledby="exampleModalLabel" aria-hidden="true">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title" id="exampleModalLabel">UPDATE VISITOR</h5>
										<button type="button" class="close" data-dismiss="modal" aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">

										<form id="updateform">

											<div class="form-group">
												<label for="recipient-name" class="col-form-label">Visitor Name:</label>
												<input type="text" class="form-control" id="Name2" name="name">
												<input type="hidden" name="id" id="id1">
												<input type="hidden" name="status" id="status5">
												<input type="hidden" name="meetwhom" id="whomMeet6">

											</div>


											<div class="form-group">
												<label for="message-text" class="col-form-label">Visitor Email:</label>
												<input type="email" class="form-control" id="Email3"
													name="email"></textarea>
											</div>

											<div class="form-group">
												<label for="recipient-name" class="col-form-label">Visitor
													Mobile:</label>
												<input type="tel" class="form-control" id="Mobile4" name="mobile">


											</div>
											<div class="form-group">
												<label for="recipient-name" class="col-form-label">For Reason:</label>
												<input type="tel" class="form-control" id="Reason4" name="reason">
											</div>
											<div class="form-group">
												<label for="recipient-name" class="col-form-label">Meeting for:
												</label>
												<select name="meeting" class="form-control" id="Meeting5">
													<option value="Developer">Developer</option>
													<option value="Tester">Tester</option>
													<option value="Digital Marketing">Digital Marketing</option>
												</select>
											</div>

											<div class="modal-footer">
												<button type="button" class="btn btn-secondary"
													data-dismiss="modal">CLOSE</button>

												<button type="submit" class="btn btn-primary">UPDATE VISITOR</button>

											</div>

										</form>
									</div>

								</div>
							</div>
						</div>

						<!-- Update Modal End -->



						<!-- Boostrap Lib -->
						<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
							integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
							crossorigin="anonymous"></script>
						<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
							integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
							crossorigin="anonymous"></script>
						<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
							integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
							crossorigin="anonymous"></script>
						<!-- AjAX lib -->

						<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"> </script>

					</div>
					<!-- main center page end -->

					<!-- you can put another card here -->

				</div>

		</div>
		<!-- main-panel ends -->
	</div>
	<!-- page-body-wrapper ends -->
	</div>






	<!-- model employee data show-->
	<script>

		$(document).ready(function () {
			getVisitorTable();
			getEmployeeList();
			getAllCheckboxValue();

		});


		function getVisitorTable() {
			$.ajax({
				method: "GET",
				url: '/visitorAll',
				//contentType: 'application/json',
				success: function (data) {

					//console.log("data  " +data[i].name)



					var html = '';

					for (var i = 0; i < data.length; i++) {

						var status = data[i].status;               // used this NEW

						var visitorId = data[i].id;            // this for name ename

						var whomMeet = data[i].meetwhom || '';   // used for whom to meet section add



						var checkbox = '<input type="checkbox" style="transform: scale(1.5);" onclick="passtheId(' + data[i].id + ');" class="visitor-checkbox" id="checkbox' + data[i].id + '" >';

						html += '<tr>'
							+ '<td>' + checkbox + ' </td>'
							+ '<td>' + data[i].name + '</td>'
							+ '<td>' + data[i].email + '</td>'
							+ '<td>' + data[i].mobile + '</td>'
							+ '<td>' + data[i].reason + '</td>'
							+ '<td >' + '<span class="badge bg-warning text-center" style="font-size:15px">' + whomMeet + '</span>' + '</td>'
							+ '<td id="status' + visitorId + '">' + '<span class="badge bg-success text-center" style="font-size:15px">' + status + '</td>'
							+ '<td>' + '<span class="badge bg-info text-center" style="font-size:15px">' + data[i].meeting + '</td>'
							+ '<td>' + '<a class="btn btn-success" data-toggle="modal" data-target="#updatebtn"  id="updatebutton" data="' + data[i].id + '" ><i class="fa fa-pencil-square" aria-hidden="true"></i></a> <a id="delete"  onclick="deleteVisitor(' + data[i].id + ')" class="delete btn btn-danger" ><i class="fa fa-trash" aria-hidden="true"></i></a>'
							+ '</td>'
						'</tr>';
					}

					$('#Table').html(html);

				},
				error: function () {
					alert("not working");
				}
			});
		}

		//alert("working or .....")


		//---------------visitor click to add button data save------------------------//

		$(document).on('submit', '#Visitorform', function (e) {

			e.preventDefault();


			toastr.success('Visitor Successfully add..!');


			var saveVisitor = $("#Visitorform").serialize();


			console.log(saveVisitor)

			$.ajax({
				type: "POST",
				url: '/visitorSave',
				dataType: 'json',
				data: saveVisitor,
				success: function (response) {

					getVisitorTable();
				},

			});
		});

		//update the visitor

		$(document).on('click', '#updatebutton', function () {

			const id = $(this).attr("data");

			console.log("update showwwsss.." + id);

			$.ajax({
				type: "GET",
				url: '/updateVisitor',
				contentType: 'application/json',
				data: {id: id},
				success: function (data) {
					console.log("Display.." + data.email);

					$('#id1').val(data.id);
					$('#Name2').val(data.name);
					$('#Email3').val(data.email);
					$('#Mobile4').val(data.mobile);
					$('#Reason4').val(data.reason);
					$('#status5').val(data.status); // show to the hidde assign show
					$('#whomMeet6').val(data.meetwhom);

					$('#Meeting5').val("Defaultmeeting");

					if (data.meeting) {
						$('#Meeting5').val(data.meeting);
					}
				},

				error: function () {
					alert("Not Working..")
				}

			});

		});


		$('#updateform').on('submit', function (e) {
			e.preventDefault();

			//alert("Visitor Update successfully...!");

				toastr.success('Visitor Update successfully...!');

			var VisitorData = $("#updateform").serialize();

			console.log("   check update......" + VisitorData);

			$.ajax({
				type: "POST",
				url: '/visitorSave',
				data: VisitorData,
				success: function (response) {
					aleret("upadte the data...");

					getVisitorTable();

				},
				error: function () {
					alert("not work");
				}
			});
		});


		function deleteVisitor(id) {
			toastr.error('Visitor Successfully Deleted..');
			//alert('Visitor Successfully Deleted..')
			$.ajax({
				method: "DELETE",
				url: '/deleteVisitor/' + id,
				contentType: "application/json",
				success: function (response) {
					getVisitorTable();
				},

				error: function () {
					alert("can not delete");
				}
			});
		}


		//////////////////////  for showing the dynamic employee names  /////////////////////////////	

		function getEmployeeList() {

			const empdrop = document.getElementById("emplist");

			empdrop.innerHTML = '<option  disabled selected>--SELECT EMPLOYEE--</option>';


			fetch("/employeeAll")
				.then(response => response.json())
				.then(employeeData => {

					employeeData.forEach(employee => {
						const option = document.createElement("option");
						option.value = employee.id;   //we can set the data
						option.text = employee.name;     // display data
						empdrop.appendChild(option);

					});
				})

				.catch(error => {
					console.error("Error fetching employee names:", error);
				});
		}




		///////////////	// to select the checkbox and its return true or false////////////////		

		function passtheId(id) {
			let checkbox = document.getElementById('checkbox' + id);

			let status = '';

			if (checkbox.checked) {
				status = true;

				//alert("...checked..");
			}
			else {
				status = false;
				//alert("...Unchecked..");
			}

			$.ajax({
				method: "GET",
				url: '/passing-checkbox-id-and-status',
				data: {visitorId: id, status: status},
				success: function (response) {
					//getVisitorTable();
				},
				error: function () {
					alert("Not Save The Status..");
				}
			});
		}
		///////////////	// to END the checkbox and its return true or false////////////////

		/*	window.onload = getAllCheckboxValue();
	
			function getAllCheckboxValue() {
				document.getElementById("checkbox").checked = true;
			}   */

		function getAllCheckboxValue() {
			$.ajax({
				method: "GET",
				url: '/get-checkbox-id-and-status',
				data: {},
				success: function (response) {
					//console.log('Response', response);

					for (var i = 0; i < response.length; i++) {
						if (response[i].status == 'true') {
							document.getElementById("checkbox" + response[i].visitorId).checked = true;
						}
					}
				},
				error: function () {
					alert("Unable to save the status..");
				}
			});
		}




		function assignMeeting() {
			let empId = document.getElementById('emplist').value;

			if (!empId || empId === "--SELECT EMPLOYEE--") {
				toastr.error('Please Select The Employee..');
				return;
			}

			$.ajax({
				method: "POST",
				url: '/save',
				data: {empId: empId},
				success: function (response) {
					var timestamp = response.timestamp;


					if (timestamp) {
						document.getElementById('timestampElementId').innerHTML = 'Timestamp: ' + timestamp;
					}

					toastr.success('Meeting Assigned Successfully!');
					getVisitorTable();
				},
				error: function () {
					toastr.error('Unable to save data');
				}
			});
		}






	</script>
	<!-- base:js -->
	<!--  <script src="vendors/base/vendor.bundle.base.js"></script>
--> <!-- endinject -->
	<!-- Plugin js for this page-->
	<!-- End plugin js for this page-->
	<!-- inject:js -->

	<!--  this is toast start js and css  -->

	<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

	<!--  this is toast end js and css  -->


	<script src="Admin/js/off-canvas.js"></script>
	<script src="Admin/js/hoverable-collapse.js"></script>
	<script src="Admin/js/template.js"></script>
	<!-- endinject -->
	<!-- plugin js for this page -->
	<script src="Admin/vendors/jquery-bar-rating/jquery.barrating.min.js"></script>
	<!-- End plugin js for this page -->
	<!-- Custom js for this page-->
	<script src="Admin/js/dashboard.js"></script>
	<!-- End custom js for this page-->
</body>

</html>